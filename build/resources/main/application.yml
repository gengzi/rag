server:
  port: 8883


spring:
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 1000MB
  datasource:
    url: jdbc:mysql://localhost:3306/rag_db?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: 111
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    show-sql: true # 打印SQL语句（开发环境用）
    properties:
      hibernate:
        format_sql: true  # 格式化SQL
    database-platform: org.hibernate.dialect.MySQL8Dialect  # 指定MySQL方言
  elasticsearch:
    uris: http://localhost:9200
    username: elastic
    password: 5KH90zCh
  ai:
    mcp:
      client:
        root-change-notification: true
    chat:
      client:
        enabled: false
      memory:
        repository:
          jdbc:
            initialize-schema: always
    model:
      embedding: ollama
    ollama:
      init:
        pull-model-strategy: never
      base-url: http://localhost:11434
      embedding:
        options:
          model: qwen3-embedding:0.6b
#    vectorstore:
#      elasticsearch:
#        initialize-schema: true
#        index-name: rag_store
#        dimensions: 1024
#        similarity: cosine
#        embedding-field-name: q_1024_vec
    openai:
      api-key: test
## es相关配置
esVectorstore:
  index-name: rag_store_new
  dimensions: 1024
  similarity: cosine
  embedding-field-name: q_1024_vec

## 第三方模型参数配置
model:
  ppStructureV3:
    url: http://localhost:8885/layout-parsing
  markItDown:
    url: http://localhost:8050/convert/fileurl

## 对象存储相关配置
s3:
  endpoint: http://192.168.31.131:8886
  access-key: minioadmin
  secret-key: minioadmin
  default-bucket-name: rag
  async-netty-pool:
    core-threads: 10
    max-threads: 50
    connection-timeout: 100
    max-pending-connection-acquires: 1000


## 各环节系统默认提示词配置
prompt:
  queryTranslation:
    rewriteSysPromptStr: "你是一名专业的RAG（检索增强生成）系统提问优化专家，核心任务是快速将用户原始问题转化为含核心关键词、无模糊信息/冗余内容、适配知识库检索的清晰问题，且不偏离用户真实需求。\n 优化要点：1. 消除模糊性，定位并补充用户提问中模糊、省略的关键信息（如未明确的时间、主体、场景、领域等），避免歧义；2. 删除无关内容（如情绪表达、多余背景描述）；3. 若原问题已清晰则直接保留。\n 示例：1. 原问 “这个协议有效期多久？”→优化 “【XX 协议】的有效期多久？”；2. 原问 “我试了好几次，电脑连不上网”→优化 “电脑无法联网的解决方法？”；3. 原问 “什么是 RAG 检索？”→优化 “什么是 RAG 检索？”（直接保留）。\n 输出要求：仅提供优化后的最终问题，若存在严重歧义且无法合理推测，则将原问题保留，无需其他额外说明"
    intentAnalysisSysPromptStr: "你是查询意图分析助手，判断用户提问是否需要多轮补充信息,无论有多少聊天记录，你都必须按此规则执行：\n\n### 判断标准 \n1. 信息缺失：缺核心要素（如 ' 申请贷款 ' 缺' 个人 / 企业 ' 类型）\n2. 有歧义：多解读可能（如 ' 苹果价格 ' 指水果还是手机）\n3. 太宽泛：需细化（如 ' 学编程 ' 缺' 语言 / 阶段 '）\n\n### 输出要求 \n- 需澄清：输出 ' 需要澄清，缺失：[最多 3 项]'\n- 无需：输出 ' 无需澄清 '\n- 不额外解释 \n\n 示例：\n 用户问：' 办社保？'\n 输出：' 需要澄清，缺失：类型（个人 / 企业）、地区、业务 '\n\n 用户问：'2025 上海职工社保基数？'\n 输出：' 无需澄清'"



## jwt相关配置
user:
  jwt:
    jwtSecret: pwKtHLwn5wurpahhR4tZjNdEfXE3pG0rQweG/4tbV0k1AV93ji9CLxfuGWR8rRtgqvJrE3/M3RtAHQngK2QYIA==
    jwtExpirationMs: 86400000

## 自定义对话模型参数配置
chatmodel:
  apiKey: sk-ltrjtwcekfkowwmdqghjzgfkjhylcocxibuuviorbnfzvqqj
  baseUrl: https://api.siliconflow.cn
  model: deepseek-ai/DeepSeek-V3
  ## 由于构建rag程序，设置模型的温度低一点。较高的值（例如 0.8）会使输出更具随机性，而较低的值（例如 0.2）会使输出更具针对性和确定性
  temperature: 0.3

rerankermodel:
  apiKey: sk-ltrjtwcekfkowwmdqghjzgfkjhylcocxibuuviorbnfzvqqj
  baseUrl: https://api.siliconflow.cn
  model: BAAI/bge-reranker-v2-m3
  instruction: "Please rerank the documents based on the query."
#  instruction: "Given a user's query and a Markdown (md) document chunk retrieved by the RAG system, determine the relevance of the document chunk to answering the query. The md chunk may contain format symbols such as # (headings), * (bold/italic), - (lists), ``` (code blocks), or | (tables) — focus on the core content wrapped by these symbols, not the symbols themselves.
#
#Relevance is defined as:
#1. The chunk contains direct information that answers the query (e.g., facts, explanations, step-by-step guides).
#2. The chunk contains indirect information that helps infer the answer (e.g., background context, related concepts necessary to understand the answer).
#3. The chunk is topically aligned and provides supplementary details that enrich the answer (even if not strictly required).
#
#Notes:
#- Ignore irrelevant content in the chunk; only check if any part of the chunk meets the above criteria.
#- Treat synonyms, abbreviations, and domain-specific terms as equivalent (e.g., 'AI' = 'artificial intelligence', 'risk control' = 'risk management').
#- Bold text (marked with **) or heading text (marked with #) in the md chunk often indicates key information — prioritize evaluating these parts.
#"

multimodel:
  apiKey: sk-ltrjtwcekfkowwmdqghjzgfkjhylcocxibuuviorbnfzvqqj
  baseUrl: https://api.siliconflow.cn
  model: zai-org/GLM-4.5V


## 各项指标
weight-of-basic-indicators:
  faithfulness: 5%
  answerRelevancy: 20%
  answerSimilarity: 30%
  contextRecall: 20%
  contextPrecision: 10%
  contextRelevancy: 15%

## 日志相关
logging:
  level:
    com.gengzi: debug
  # 日志文件配置（可选）
  file:
    name: logs/rag-server.log  # 日志文件路径和名称
  # 滚动日志配置（按大小分割）
  logback:
    rollingpolicy:
      file-name-pattern: logs/rag-server.%d{yyyy-MM-dd}.%i.log  # 滚动文件命名格式
      max-file-size: 2MB  # 触发滚动的文件大小
      total-size-cap: 100MB  # 日志文件总大小上限
      max-history: 7
  # 自定义 Logback 配置（关键：分离 error 日志）
  config: classpath:logback-spring.xml  # 引入外部配置文件
trace: true