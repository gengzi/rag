

### 聊天消息的存储问题
* 早期mvp，借鉴ragflow 的实现，存储消息体内容使用的是大json存储，如果聊天对话记录过多，每次加载历史记录，更新聊天记录，
都会导致数据库的性能下降，还有每次传输的数据量过大，前端加载时渲染dom时会很慢。
优化方式：
* 消息记录不使用json存储，使用每行存储，可以进行分页查询，写入性能也非常高
```sql
CREATE TABLE chat_messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,   -- 全局唯一ID（可选）
    session_id VARCHAR(64) NOT NULL,        -- 会话ID（如 "sess_abc123"）
    seq_no INT NOT NULL,                    -- 会话内序号（1,2,3...）
    role ENUM('user', 'assistant') NOT NULL,
    content TEXT NOT NULL,
    tokens INT DEFAULT 0,                   -- 预计算 token 数（用于上下文裁剪）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- 联合主键 or 唯一索引
    UNIQUE KEY uk_session_seq (session_id, seq_no),
    INDEX idx_session_time (session_id, created_at)
);
```
* 分页查询，前端加载最近 50 条 ，向上滚动，加载更早消息
* 更新聊天记忆，每次只插入一行到两行


